<!DOCTYPE html>
<html class="light" dir="<%= locale === 'ar' ? 'rtl' : 'ltr' %>" lang="<%= locale %>">

<head>
    <%- include('../../partials/head') %>
</head>

<body
    class="bg-background-light dark:bg-background-dark text-[#181113] dark:text-white transition-colors duration-200 noise-bg min-h-screen flex items-center justify-center p-4">
    <div
        class="w-full max-w-lg glass border border-white/20 dark:border-white/5 rounded-[3rem] p-12 shadow-premium animate-scale-in relative overflow-hidden">
        <div class="absolute -top-24 -right-24 size-64 bg-primary/5 rounded-full blur-3xl"></div>

        <div class="text-center mb-12 relative z-10">
            <div
                class="size-24 bg-primary/10 rounded-[2rem] flex items-center justify-center mx-auto mb-8 animate-pulse">
                <span class="material-symbols-outlined text-primary text-5xl">phonelink_lock</span>
            </div>
            <h1 class="text-4xl font-black mb-4">تأكيد رقم الهاتف</h1>
            <p class="text-[#896170] dark:text-gray-400 font-bold text-lg leading-relaxed">
                أرسلنا كود التحقق المكون من 6 أرقام إلى <br>
                <span
                    class="text-primary dir-ltr text-left inline-block mt-3 bg-primary/5 px-4 py-1 rounded-full text-xl font-black">
                    <%= phone %>
                </span>
            </p>
        </div>

        <%- include('../../partials/flash') %>

            <form action="/verify-phone" method="POST" id="otpForm" class="relative z-10">
                <div class="flex justify-between gap-2 md:gap-4 mb-12 dir-ltr">
                    <% for(let i=0; i<6; i++) { %>
                        <input type="text" maxlength="1"
                            class="otp-field w-full aspect-square text-center text-4xl font-black rounded-3xl border-2 border-gray-100 dark:border-[#2d1a22] bg-gray-50/50 dark:bg-[#1a0c10] shadow-inner focus:border-primary focus:bg-white dark:focus:bg-[#2d1a22] focus:ring-[12px] focus:ring-primary/5 transition-all outline-none"
                            required <%=i===0 ? 'autofocus' : '' %>>
                        <% } %>
                </div>

                <input type="hidden" name="code" id="fullCode">

                <button type="submit"
                    class="w-full h-20 gradient-bg text-white rounded-[2rem] font-black text-2xl shadow-2xl shadow-primary/30 btn-bounce shimmer">
                    <span>تـحـقـق الآن</span>
                </button>
            </form>

            <div class="mt-10 text-center relative z-10">
                <p class="text-[#896170] font-bold">لم يصلك الكود؟</p>
                <form action="/resend-otp" method="POST" class="mt-4">
                    <button type="submit"
                        class="text-primary font-black hover:underline underline-offset-8 decoration-2 text-lg transition-all">
                        إعادة إرسال الكود
                    </button>
                </form>

                <% if (process.env.NODE_ENV !=='production' ) { %>
                    <div class="mt-8 p-4 bg-gold/10 border border-gold/20 rounded-2xl">
                        <p class="text-[10px] text-gold font-black uppercase tracking-widest mb-1">بيئة التطوير
                            (Developer Note)</p>
                        <p class="text-xs text-[#896170]">الكود يتم إرساله حالياً إلى **Terminal** الخاص بالموقع. <br>
                            تحققي من الكود هناك لإتمام العملية.</p>
                    </div>
                    <% } %>
            </div>

            <div
                class="mt-12 pt-8 border-t border-dashed border-[#e6dbdf] dark:border-[#3d252e] text-center relative z-10">
                <a href="/logout"
                    class="text-[#896170] hover:text-red-500 transition-colors flex items-center justify-center gap-3 text-lg font-black group">
                    <span
                        class="material-symbols-outlined group-hover:-translate-x-2 transition-transform">logout</span>
                    <span>تسجيل الخروج والرجوع</span>
                </a>
            </div>
    </div>

    <script>
        const inputs = document.querySelectorAll('.otp-field');
        const form = document.getElementById('otpForm');
        const fullCodeInput = document.getElementById('fullCode');

        inputs.forEach((input, index) => {
            input.addEventListener('input', (e) => {
                if (e.target.value && index < inputs.length - 1) {
                    inputs[index + 1].focus();
                }
            });

            input.addEventListener('keydown', (e) => {
                if (e.key === 'Backspace' && !e.target.value && index > 0) {
                    inputs[index - 1].focus();
                }
            });

            // Prevent non-numeric input
            input.addEventListener('keypress', (e) => {
                if (!/[0-9]/.test(e.key)) {
                    e.preventDefault();
                }
            });

            // Handle Paste
            input.addEventListener('paste', (e) => {
                const pasteData = e.clipboardData.getData('text').slice(0, 6);
                if (pasteData.length === 6 && /^\d+$/.test(pasteData)) {
                    pasteData.split('').forEach((char, i) => {
                        inputs[i].value = char;
                    });
                    inputs[5].focus();
                    e.preventDefault();
                }
            });
        });

        form.addEventListener('submit', (e) => {
            let code = '';
            inputs.forEach(input => code += input.value);
            fullCodeInput.value = code;
        });
    </script>
</body>

</html>