<!DOCTYPE html>
<html class="light" dir="<%= locale === 'ar' ? 'rtl' : 'ltr' %>" lang="<%= locale %>">

<head>
    <%- include('../../../partials/head') %>
</head>

<body class="bg-[#f8f9fa] dark:bg-[#1a0c10] text-[#181113] dark:text-white transition-colors duration-200">
    <div class="flex min-h-screen">
        <!-- Sidebar -->
        <%- include('../../../partials/sidebar', { role: 'owner' }) %>

            <!-- Main Content -->
            <main class="flex-1 <%= locale === 'ar' ? 'md:mr-64' : 'md:ml-64' %> transition-all p-8">
                <header class="flex items-center justify-between mb-8">
                    <div>
                        <h1 class="text-2xl font-bold">Ù…Ø¹Ø±Ø¶ ØµÙˆØ± Ø§Ù„ØµØ§Ù„ÙˆÙ† ğŸ“¸</h1>
                        <p class="text-[#896170]">Ø£Ø¶ÙŠÙÙŠ Ù„Ù…Ø³Ø§ØªÙƒ Ø§Ù„Ø¥Ø¨Ø¯Ø§Ø¹ÙŠØ© ÙˆØµÙˆØ±Ø§Ù‹ Ù„ØµØ§Ù„ÙˆÙ†ÙƒÙ Ù„Ø¬Ø°Ø¨ Ø§Ù„Ù…Ø²ÙŠØ¯ Ù…Ù† Ø§Ù„Ø¹Ù…ÙŠÙ„Ø§Øª</p>
                    </div>
                    <div class="flex flex-col items-end gap-2">
                        <div
                            class="text-xs font-bold text-[#896170] bg-gray-100 dark:bg-white/5 px-3 py-1.5 rounded-full border border-[#e6dbdf] dark:border-[#3d252e]">
                            <span>Ø§Ù„ØµÙˆØ± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø©: </span>
                            <span class="<%= (gallery && gallery.length >= 4) ? 'text-red-500' : 'text-primary' %>">
                                <%= (gallery ? gallery.length : 0) %>
                            </span>
                            <span class="opacity-50">/ 4</span>
                        </div>
                        <% if (!gallery || gallery.length < 4) { %>
                            <button
                                onclick="document.getElementById('addPhotoModal').classList.replace('hidden', 'flex')"
                                class="gradient-bg text-white px-6 py-3 rounded-xl font-bold shadow-lg hover:shadow-2xl transition-all flex items-center gap-2">
                                <span class="material-symbols-outlined">add_a_photo</span>
                                <span>Ø¥Ø¶Ø§ÙØ© ØµÙˆØ±Ø© Ø¬Ø¯ÙŠØ¯Ø©</span>
                            </button>
                            <% } else { %>
                                <button
                                    class="bg-gray-200 dark:bg-white/5 text-gray-400 px-6 py-3 rounded-xl font-bold border border-gray-300 dark:border-white/10 flex items-center gap-2 cursor-not-allowed"
                                    title="ØªÙ… Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ (4 ØµÙˆØ±)">
                                    <span class="material-symbols-outlined">block</span>
                                    <span>ÙˆØµÙ„ØªÙ Ù„Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰</span>
                                </button>
                                <% } %>
                    </div>
                </header>

                <%- include('../../../partials/flash') %>

                    <!-- Gallery Grid -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <% if (gallery && gallery.length> 0) { %>
                            <% gallery.forEach(function(item) { %>
                                <div
                                    class="group relative bg-white dark:bg-[#2d1a22] rounded-2xl overflow-hidden border-2 border-[#e6dbdf] dark:border-[#3d252e] shadow-sm hover:shadow-xl transition-all aspect-video">
                                    <img src="<%= item.image_url %>" alt="<%= item.caption %>"
                                        class="w-full h-full object-cover">

                                    <!-- Caption Bar (Always Visible) -->
                                    <% if (item.caption) { %>
                                        <div
                                            class="absolute bottom-0 left-0 right-0 bg-black/60 backdrop-blur-sm p-2 transform translate-y-0 transition-transform group-hover:translate-y-full">
                                            <p class="text-white text-center text-xs font-bold truncate">
                                                <%= item.caption %>
                                            </p>
                                        </div>
                                        <% } %>

                                            <!-- Overlay Actions (Hover) -->
                                            <div
                                                class="absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 transition-opacity flex flex-col items-center justify-center p-4">
                                                <% if (item.caption) { %>
                                                    <p
                                                        class="text-white text-center font-bold mb-4 line-clamp-3 text-sm">
                                                        <%= item.caption %>
                                                    </p>
                                                    <% } %>
                                                        <div class="flex gap-4">
                                                            <form
                                                                action="/dashboard/owner/gallery/delete/<%= item.id %>"
                                                                method="POST"
                                                                onsubmit="return confirm('Ù‡Ù„ Ø£Ù†ØªÙ Ù…ØªØ£ÙƒØ¯Ø© Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„ØµÙˆØ±Ø©ØŸ')">
                                                                <button type="submit"
                                                                    class="bg-red-500 text-white p-3 rounded-xl hover:bg-red-600 transition-colors shadow-lg">
                                                                    <span
                                                                        class="material-symbols-outlined">delete</span>
                                                                </button>
                                                            </form>
                                                            <button onclick="viewImage('<%= item.image_url %>')"
                                                                class="bg-white text-primary p-3 rounded-xl hover:bg-gray-100 transition-colors shadow-lg">
                                                                <span
                                                                    class="material-symbols-outlined">visibility</span>
                                                            </button>
                                                        </div>
                                            </div>
                                </div>
                                <% }); %>
                                    <% } else { %>
                                        <div
                                            class="col-span-full py-24 text-center bg-white dark:bg-[#2d1a22] rounded-2xl border-2 border-dashed border-[#e6dbdf] dark:border-[#3d252e]">
                                            <div
                                                class="w-20 h-20 bg-gray-50 dark:bg-[#1a0c10] rounded-full flex items-center justify-center mx-auto mb-4 border border-[#e6dbdf] dark:border-[#3d252e]">
                                                <span
                                                    class="material-symbols-outlined text-4xl opacity-20 text-primary">add_photo_alternate</span>
                                            </div>
                                            <h3 class="text-xl font-bold text-[#896170]">Ù„Ø§ ØªÙˆØ¬Ø¯ ØµÙˆØ± ÙÙŠ Ø§Ù„Ù…Ø¹Ø±Ø¶ Ø¨Ø¹Ø¯</h3>
                                            <p class="text-[#896170]/60 mt-2">Ø§Ø¨Ø¯Ø¦ÙŠ Ø¨Ø¥Ø¶Ø§ÙØ© Ø£ÙˆÙ„ ØµÙˆØ±Ø© Ù„ØªØ¹Ø±ÙŠÙ Ø§Ù„Ø¹Ù…ÙŠÙ„Ø§Øª
                                                Ø¨Ø¬Ù…Ø§Ù„ ØµØ§Ù„ÙˆÙ†ÙƒÙ!</p>
                                        </div>
                                        <% } %>
                    </div>
            </main>
    </div>

    <!-- Add Photo Modal -->
    <div id="addPhotoModal"
        class="fixed inset-0 bg-black/60 backdrop-blur-md z-[100] hidden items-center justify-center p-4">
        <div class="bg-white dark:bg-[#2d1a22] rounded-[2rem] max-w-lg w-full p-8 relative animate-scale-in">
            <button onclick="document.getElementById('addPhotoModal').classList.replace('flex', 'hidden')"
                class="absolute top-6 left-6 text-[#896170] hover:text-red-500 transition-colors">
                <span class="material-symbols-outlined">close</span>
            </button>
            <div class="mb-8">
                <h2 class="text-2xl font-black mb-2">Ø¥Ø¶Ø§ÙØ© ØµÙˆØ±Ø© Ù„Ù„Ù…Ø¹Ø±Ø¶</h2>
                <p class="text-[#896170]">ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¶Ø§ÙØ© Ø­ØªÙ‰ 4 ØµÙˆØ± ÙÙ‚Ø· ÙÙŠ Ø§Ù„Ù…Ø¹Ø±Ø¶ (Ù„Ø¯ÙŠÙƒ <%= (gallery ? gallery.length : 0)
                        %>/4)</p>
            </div>

            <form action="/dashboard/owner/gallery" method="POST" enctype="multipart/form-data" class="space-y-6">
                <!-- Image Upload Area -->
                <div class="space-y-4">
                    <label class="block text-sm font-bold opacity-70">Ø§Ù„ØµÙˆØ±Ø©</label>
                    <div class="relative group">
                        <div id="dropZone" onclick="document.getElementById('galleryImage').click()"
                            class="w-full h-48 rounded-2xl border-2 border-dashed border-[#e6dbdf] dark:border-[#3d252e] bg-gray-50 dark:bg-[#1a0c10] flex flex-col items-center justify-center cursor-pointer hover:border-primary transition-all overflow-hidden relative">
                            <img id="modalPreview" class="hidden w-full h-full object-cover">
                            <div id="modalPlaceholder" class="flex flex-col items-center text-[#896170]">
                                <span class="material-symbols-outlined text-5xl mb-3">cloud_upload</span>
                                <span class="text-sm font-bold">Ø§Ø¶ØºØ·ÙŠ Ù„Ø§Ø®ØªÙŠØ§Ø± ØµÙˆØ±Ø©</span>
                                <span class="text-[10px] opacity-60 mt-1">PNG, JPG Ø­ØªÙ‰ 5 Ù…ÙŠØ¬Ø§Ø¨Ø§ÙŠØª</span>
                            </div>
                        </div>
                        <input type="file" id="galleryImage" name="gallery_image" class="hidden" accept="image/*"
                            required onchange="previewGalleryImage(this)">
                    </div>
                </div>

                <div class="space-y-2">
                    <label class="block text-sm font-bold opacity-70">ÙˆØµÙ Ù‚ØµÙŠØ± (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
                    <input type="text" name="caption"
                        class="w-full h-14 px-5 rounded-xl border border-[#e6dbdf] dark:border-[#3d252e] bg-gray-50 dark:bg-[#1a0c10] focus:ring-2 focus:ring-primary outline-none font-bold"
                        placeholder="Ù…Ø«Ø§Ù„: Ø±ÙƒÙ† Ø§Ù„Ø¹Ù†Ø§ÙŠØ© Ø¨Ø§Ù„Ø¨Ø´Ø±Ø©ØŒ ØµØ§Ù„Ø© Ø§Ù„Ø§Ø³ØªÙ‚Ø¨Ø§Ù„...">
                </div>

                <div class="pt-6">
                    <button type="submit"
                        class="w-full h-16 gradient-bg text-white rounded-xl font-bold text-lg shadow-xl btn-bounce shimmer">
                        Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø©
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Image Review Modal -->
    <div id="imageViewModal"
        class="fixed inset-0 bg-black/90 backdrop-blur-sm z-[110] hidden items-center justify-center p-4">
        <button onclick="document.getElementById('imageViewModal').classList.replace('flex', 'hidden')"
            class="absolute top-8 left-8 text-white hover:text-primary transition-colors z-20">
            <span class="material-symbols-outlined text-4xl">close</span>
        </button>
        <img id="fullImage" src="" class="max-w-full max-h-[90vh] rounded-xl shadow-2xl animate-fade-in">
    </div>

    <script>
        function previewGalleryImage(input) {
            const preview = document.getElementById('modalPreview');
            const placeholder = document.getElementById('modalPlaceholder');
            const dropZone = document.getElementById('dropZone');

            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    preview.src = e.target.result;
                    preview.classList.remove('hidden');
                    placeholder.classList.add('hidden');
                    dropZone.classList.remove('border-dashed');
                }
                reader.readAsDataURL(input.files[0]);
            }
        }

        function viewImage(url) {
            const modal = document.getElementById('imageViewModal');
            const img = document.getElementById('fullImage');
            img.src = url;
            modal.classList.replace('hidden', 'flex');
        }
    </script>
</body>

</html>