<!DOCTYPE html>
<html class="light" dir="<%= locale === 'ar' ? 'rtl' : 'ltr' %>" lang="<%= locale %>">

<head>
    <%- include('../../../partials/head') %>
</head>

<body class="bg-[#f8f9fa] dark:bg-[#1a0c10] text-[#181113] dark:text-white transition-colors duration-200">
    <div class="flex min-h-screen">
        <!-- Sidebar -->
        <%- include('../../../partials/sidebar', { role: 'owner' }) %>

            <!-- Main Content -->
            <main class="flex-1 <%= locale === 'ar' ? 'md:mr-64' : 'md:ml-64' %> transition-all p-8">
                <!-- Top Bar -->
                <header class="flex items-center justify-between mb-8">
                    <div>
                        <h1 class="text-2xl font-bold">إدارة الاشتراك</h1>
                        <p class="text-[#896170]">اختاري الخطة المناسبة لعملكِ</p>
                    </div>
                    <div class="flex items-center gap-4">
                        <%- include('../../../partials/theme-toggle') %>
                            <!-- User Avatar -->
                            <div
                                class="h-10 w-10 rounded-full bg-primary text-white flex items-center justify-center font-bold overflow-hidden border-2 border-white dark:border-[#2d1a22] shadow-sm">
                                <% if (user && user.avatar) { %>
                                    <img src="<%= user.avatar %>" class="w-full h-full object-cover object-center">
                                    <% } else { %>
                                        <%= user ? user.name.charAt(0).toUpperCase() : 'S' %>
                                            <% } %>
                            </div>
                    </div>
                </header>

                <%- include('../../../partials/alerts') %>

                    <!-- Current Status -->
                    <section class="mb-12">
                        <% if (typeof pendingRequest !=='undefined' && pendingRequest) { %>
                            <div
                                class="bg-yellow-50 dark:bg-yellow-900/10 border-r-4 border-yellow-500 p-6 rounded-2xl mb-8 flex items-center gap-4">
                                <div class="bg-yellow-100 dark:bg-yellow-900/30 p-3 rounded-xl text-yellow-600">
                                    <span class="material-symbols-outlined text-2xl">hourglass_top</span>
                                </div>
                                <div>
                                    <h3 class="font-bold text-yellow-800 dark:text-yellow-200 text-lg">طلبك قيد المراجعة
                                    </h3>
                                    <p class="text-yellow-700 dark:text-yellow-300 text-sm">
                                        لقد قمتِ بطلب اشتراك
                                        <span class="font-black">
                                            <%= pendingRequest.plan_type==='monthly' ? 'شهري' :
                                                (pendingRequest.plan_type==='3months' ? '3 شهور' :
                                                (pendingRequest.plan_type==='6months' ? '6 شهور' : 'سنوي' )) %>
                                        </span>
                                        بتاريخ <%= new Date(pendingRequest.created_at).toLocaleDateString('ar-EG') %>.
                                            سيتم تفعيله قريباً.
                                    </p>
                                </div>
                            </div>
                            <% } %>

                                <div
                                    class="bg-white dark:bg-[#2d1a22] p-8 rounded-3xl border border-[#e6dbdf] dark:border-[#3d252e] shadow-sm flex flex-col md:flex-row items-center justify-between gap-6">
                                    <div>
                                        <h2 class="text-xl font-bold mb-2">حالة الاشتراك الحالية</h2>
                                        <div class="flex items-center gap-2">
                                            <span class="text-sm text-[#896170] font-bold">الحالة:</span>
                                            <span
                                                class="px-3 py-1 rounded-full text-xs font-black <%= salon.subscription_status === 'active' ? 'bg-green-100 text-green-600' : 'bg-red-100 text-red-600' %>">
                                                <%= salon.subscription_status==='active' ? 'نشط' :
                                                    (salon.subscription_status==='expired' ? 'منتهي' : 'تجريبي' ) %>
                                            </span>
                                        </div>
                                        <div class="flex items-center gap-2 mt-2">
                                            <span class="text-sm text-[#896170] font-bold">ينتهي في:</span>
                                            <span class="text-lg font-black dir-ltr">
                                                <%= new Date(salon.subscription_end).toLocaleDateString('en-GB') %>
                                            </span>
                                        </div>
                                    </div>

                                    <% // Check if subscription is still valid (including trial period) const
                                        isSubscriptionValid=salon.subscription_end && new Date(salon.subscription_end)>
                                        new Date();
                                        const daysRemaining = isSubscriptionValid ? Math.ceil((new
                                        Date(salon.subscription_end) - new Date()) / (1000 * 60 * 60 * 24)) : 0;
                                        %>

                                        <% if (isSubscriptionValid) { %>
                                            <div class="text-center">
                                                <div class="text-4xl font-black text-primary">
                                                    <%= daysRemaining %>
                                                </div>
                                                <div class="text-xs text-[#896170] font-bold">يوم متبقي</div>
                                            </div>
                                            <% } else { %>
                                                <div class="text-center">
                                                    <div class="text-xl font-black text-red-500 mb-1">الاشتراك منتهي
                                                    </div>
                                                    <p class="text-xs text-red-400">يرجى التجديد للاستمرار في الاستفادة
                                                        من
                                                        خدمات
                                                        المنصة</p>
                                                </div>
                                                <% } %>
                                </div>
                    </section>

                    <!-- Plans Selection -->
                    <section>
                        <h2 class="text-2xl font-bold mb-6 text-center">باقات الاشتراك المتاحة</h2>

                        <form action="/dashboard/owner/subscription/request" method="POST"
                            class="<%= (typeof pendingRequest !== 'undefined' && pendingRequest) ? 'pointer-events-none opacity-50 grayscale' : '' %>">
                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-10">
                                <!-- Monthly Plan -->
                                <label class="cursor-pointer group relative">
                                    <input type="radio" name="plan_type" value="monthly" class="peer sr-only" <%=(typeof
                                        pendingRequest !=='undefined' && pendingRequest) ? 'disabled' : '' %>>
                                    <div
                                        class="h-full bg-white dark:bg-[#2d1a22] p-6 rounded-3xl border-2 border-[#e6dbdf] dark:border-[#3d252e] peer-checked:border-primary peer-checked:bg-primary/5 transition-all flex flex-col items-center text-center hover:border-primary/50">
                                        <div
                                            class="size-16 bg-blue-500/10 text-blue-500 rounded-2xl flex items-center justify-center mb-4">
                                            <span class="material-symbols-outlined text-3xl">calendar_month</span>
                                        </div>
                                        <h3 class="text-lg font-black mb-2">شهري</h3>
                                        <div class="text-3xl font-black text-primary mb-4">
                                            <%= siteSettings?.subs_month_price || 150 %> <span
                                                    class="text-sm text-[#896170]">ج.م</span>
                                        </div>
                                        <ul class="space-y-2 text-sm text-[#896170] mb-6 flex-1">
                                            <li>مدة 30 يوم</li>
                                            <li>دعم فني كامل</li>
                                            <li>ظهور في نتائج البحث</li>
                                        </ul>
                                        <span
                                            class="w-full py-2 rounded-xl bg-gray-100 dark:bg-white/5 font-bold peer-checked:bg-primary peer-checked:text-white transition-colors">اختيار
                                            الباقة</span>
                                    </div>
                                </label>

                                <!-- 3 Months Plan -->
                                <label class="cursor-pointer group relative">
                                    <input type="radio" name="plan_type" value="3months" class="peer sr-only" <%=(typeof
                                        pendingRequest !=='undefined' && pendingRequest) ? 'disabled' : '' %>>
                                    <div
                                        class="h-full bg-white dark:bg-[#2d1a22] p-6 rounded-3xl border-2 border-[#e6dbdf] dark:border-[#3d252e] peer-checked:border-primary peer-checked:bg-primary/5 transition-all flex flex-col items-center text-center hover:border-primary/50 relative overflow-hidden">
                                        <div
                                            class="absolute top-0 right-0 bg-primary text-white text-[10px] px-3 py-1 rounded-bl-xl font-bold">
                                            باقة التوفير</div>
                                        <div
                                            class="size-16 bg-green-500/10 text-green-500 rounded-2xl flex items-center justify-center mb-4">
                                            <span class="material-symbols-outlined text-3xl">savings</span>
                                        </div>
                                        <h3 class="text-lg font-black mb-2">3 شهور</h3>
                                        <div class="text-3xl font-black text-primary mb-4">
                                            <%= siteSettings?.subs_3months_price || 400 %> <span
                                                    class="text-sm text-[#896170]">ج.م</span>
                                        </div>
                                        <ul class="space-y-2 text-sm text-[#896170] mb-6 flex-1">
                                            <li>مدة 90 يوم</li>
                                            <li>توفير 50 ج.م</li>
                                            <li>أولوية في الدعم</li>
                                        </ul>
                                        <span
                                            class="w-full py-2 rounded-xl bg-gray-100 dark:bg-white/5 font-bold peer-checked:bg-primary peer-checked:text-white transition-colors">اختيار
                                            الباقة</span>
                                    </div>
                                </label>

                                <!-- 6 Months Plan -->
                                <label class="cursor-pointer group relative">
                                    <input type="radio" name="plan_type" value="6months" class="peer sr-only" <%=(typeof
                                        pendingRequest !=='undefined' && pendingRequest) ? 'disabled' : '' %>>
                                    <div
                                        class="h-full bg-white dark:bg-[#2d1a22] p-6 rounded-3xl border-2 border-[#e6dbdf] dark:border-[#3d252e] peer-checked:border-primary peer-checked:bg-primary/5 transition-all flex flex-col items-center text-center hover:border-primary/50">
                                        <div
                                            class="size-16 bg-purple-500/10 text-purple-500 rounded-2xl flex items-center justify-center mb-4">
                                            <span class="material-symbols-outlined text-3xl">workspace_premium</span>
                                        </div>
                                        <h3 class="text-lg font-black mb-2">6 شهور</h3>
                                        <div class="text-3xl font-black text-primary mb-4">
                                            <%= siteSettings?.subs_6months_price || 750 %> <span
                                                    class="text-sm text-[#896170]">ج.م</span>
                                        </div>
                                        <ul class="space-y-2 text-sm text-[#896170] mb-6 flex-1">
                                            <li>مدة 180 يوم</li>
                                            <li>توفير 150 ج.م</li>
                                            <li>مميزات حصرية</li>
                                        </ul>
                                        <span
                                            class="w-full py-2 rounded-xl bg-gray-100 dark:bg-white/5 font-bold peer-checked:bg-primary peer-checked:text-white transition-colors">اختيار
                                            الباقة</span>
                                    </div>
                                </label>

                                <!-- Yearly Plan -->
                                <label class="cursor-pointer group relative">
                                    <input type="radio" name="plan_type" value="yearly" class="peer sr-only" <%=(typeof
                                        pendingRequest !=='undefined' && pendingRequest) ? 'disabled' : '' %>>
                                    <div
                                        class="h-full bg-[#1a0c10] text-white p-6 rounded-3xl border-2 border-gold/50 peer-checked:border-gold peer-checked:bg-black transition-all flex flex-col items-center text-center hover:border-gold shadow-xl">
                                        <div
                                            class="size-16 bg-white/10 text-gold rounded-2xl flex items-center justify-center mb-4">
                                            <span class="material-symbols-outlined text-3xl">diamond</span>
                                        </div>
                                        <h3 class="text-lg font-black mb-2 text-gold">سنوي</h3>
                                        <div class="text-3xl font-black text-white mb-4">
                                            <%= siteSettings?.subs_year_price || 1400 %> <span
                                                    class="text-sm text-gray-400">ج.م</span>
                                        </div>
                                        <ul class="space-y-2 text-sm text-gray-400 mb-6 flex-1">
                                            <li>مدة 365 يوم</li>
                                            <li>أفضل قيمة (توفير 400 ج.م)</li>
                                            <li>شارة "صالون مميز" مجاناً</li>
                                        </ul>
                                        <span
                                            class="w-full py-2 rounded-xl bg-white/10 font-bold peer-checked:bg-gold peer-checked:text-black transition-colors">اختيار
                                            الباقة</span>
                                    </div>
                                </label>
                            </div>

                            <div class="flex justify-center">
                                <button type="submit"
                                    class="px-12 py-4 rounded-2xl gradient-bg text-white font-black text-xl shadow-xl hover:shadow-2xl hover:scale-105 transition-all flex items-center gap-3 disabled:opacity-50 disabled:cursor-not-allowed"
                                    <%=(typeof pendingRequest !=='undefined' && pendingRequest) ? 'disabled' : '' %>>
                                    <span>
                                        <%= (typeof pendingRequest !=='undefined' && pendingRequest)
                                            ? 'الطلب قيد المراجعة' : 'إرسال طلب الاشتراك' %>
                                    </span>
                                    <% if (!pendingRequest) { %>
                                        <span class="material-symbols-outlined">send</span>
                                        <% } else { %>
                                            <span class="material-symbols-outlined">lock_clock</span>
                                            <% } %>
                                </button>
                            </div>
                            <p class="text-center mt-4 text-sm text-[#896170]">
                                <%= (typeof pendingRequest !=='undefined' && pendingRequest)
                                    ? 'لا يمكنك إرسال طلب جديد حتى يتم البت في الطلب الحالي.'
                                    : 'سيتم مراجعة طلبك من قبل الإدارة والموافقة عليه في أقرب وقت.' %>
                            </p>
                        </form>
                    </section>
            </main>
    </div>
</body>

</html>